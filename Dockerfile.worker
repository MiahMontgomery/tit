FROM mcr.microsoft.com/playwright:v1.45.0-jammy
WORKDIR /app

# Copy only package files first
COPY package*.json ./

# Install all dependencies (including dev) but ignore postinstall scripts
RUN npm ci --ignore-scripts

# Copy the rest of the source code
COPY . .

# Build the worker if a build script exists (installs dev tools like vite/esbuild)
RUN npm run build --if-present

ENV NODE_ENV=production

CMD ["npm","run","start:worker"]
